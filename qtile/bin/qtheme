#!/usr/bin/python

from os import path, listdir
import subprocess
import json
import sys


user_path = path.expanduser('~')
full_path = path.join(user_path, '.config', 'qtile', 'themes', 'theme_selector.json')

def manu_themes():
    sys.stdout.write("\033[2J\033[H")
    sys.stdout.flush()
    print('\033[31mAvailable themes:\033[00m')
    for index, theme in enumerate(listdir(path.join(user_path, '.config', 'qtile', 'themes'))):
        if theme != 'theme_selector.json':
            print(f' \033[33m[{index + 1}]\033[00m -> \033[33m{theme.split('.')[0]}\033[00m')
    print('')

def set_new_theme() -> bool:
    try:
        theme = input('\033[35m[+] Type theme: \033[00m').strip()
        position = input('\033[35m[+] Type position [t/b]: \033[00m').strip()
        if path.exists(path.join(user_path, '.config', 'qtile', 'themes', theme + '.json')):
            with open(full_path, 'r+') as file:
                data = json.load(file)
                data['theme'] = theme
                data['position'] = 'bottom' if position == 'b' else 'top'
                file.seek(0)
                json.dump(data, file, indent=2, sort_keys=True)
                file.truncate()
        
            subprocess.run(['qtile', 'cmd-obj', '-o', 'cmd', '-f', 'reload_config'])
            print('\n\033[32mTheme changed correctly î¶© !\033[00m')
            return True
        else:
            print(f'\n\033[91mThe file "{theme}.json" does not exist\033[0m')
            return False

    except KeyboardInterrupt:
        print('\n\033[91mAborted\033[0m')
    finally:
        print('\n')


if __name__ == '__main__':
    manu_themes()
    set_new_theme()